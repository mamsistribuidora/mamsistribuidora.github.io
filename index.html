<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAM Distribuidora | Painel Digital</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root { --gold: #D4AF37; --dark-bg: #0a0a0a; --sidebar-bg: #000; --card-bg: #151515; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', -apple-system, sans-serif; }
        
        body { background-color: var(--dark-bg); color: #fff; min-height: 100vh; overflow-x: hidden; }
        .hidden { display: none !important; }

        /* HEADER SUPERIOR */
        header { 
            background: #000; padding: 12px 25px; border-bottom: 1px solid #222;
            display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 1000;
        }
        .header-search { flex: 1; max-width: 450px; margin: 0 20px; position: relative; }
        .header-search input { 
            width: 100%; padding: 10px 40px; border-radius: 6px; border: 1px solid #333; 
            background: #111; color: #fff; outline: none; font-size: 0.85rem;
        }
        .user-profile-top { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; color: #aaa; }
        .user-profile-top img { width: 32px; height: 32px; border-radius: 50%; border: 1px solid var(--gold); }

        /* LAYOUT PRINCIPAL */
        .app-container { display: flex; flex-direction: column; }
        @media (min-width: 992px) {
            .app-container { flex-direction: row; }
            .sidebar { width: 260px; height: calc(100vh - 62px); position: sticky; top: 62px; }
        }

        /* SIDEBAR IDENTICA √Ä IMAGEM */
        .sidebar { background: var(--sidebar-bg); padding: 25px 15px; border-right: 1px solid #1a1a1a; flex-shrink: 0; }
        .brand-box { text-align: center; margin-bottom: 35px; }
        .brand-circle { 
            width: 110px; height: 110px; border-radius: 50%; border: 3px solid var(--gold);
            margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;
            background: #000; overflow: hidden; box-shadow: 0 0 20px rgba(212, 175, 55, 0.15);
        }
        .brand-circle img { width: 100%; height: 100%; object-fit: cover; }
        
        .nav-menu { list-style: none; }
        .nav-item { 
            padding: 14px 18px; color: #888; cursor: pointer; border-radius: 8px; 
            margin-bottom: 6px; display: flex; align-items: center; gap: 12px; transition: 0.3s;
            font-size: 0.9rem;
        }
        .nav-item:hover, .nav-item.active { background: linear-gradient(90deg, rgba(212,175,55,0.2) 0%, transparent 100%); color: var(--gold); font-weight: 600; }
        .nav-item.logout { color: #ff4d4d; margin-top: 40px; }

        /* √ÅREA DE CONTE√öDO */
        .main-content { flex: 1; padding: 30px; max-width: 1200px; margin: 0 auto; width: 100%; }
        .ceo-banner { 
            background: rgba(212, 175, 55, 0.03); border: 1px dashed var(--gold); 
            padding: 20px; border-radius: 10px; margin-bottom: 35px;
        }
        .section-header { font-size: 1.25rem; font-weight: 600; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; }

        /* GRID DE DISCOS (VINIL) */
        .vinyl-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 30px; }
        .vinyl-card { text-align: center; cursor: pointer; }
        .vinyl-cover-wrapper { 
            width: 100%; aspect-ratio: 1/1; border-radius: 50%; border: 5px solid #1a1a1a; 
            overflow: hidden; margin-bottom: 12px; position: relative; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            background: #111;
        }
        .vinyl-card:hover .vinyl-cover-wrapper { transform: rotate(360deg); border-color: var(--gold); }
        .vinyl-cover-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .vinyl-card h4 { font-size: 0.9rem; font-weight: 500; margin-bottom: 4px; }
        .vinyl-card p { font-size: 0.75rem; color: #666; }

        /* CA√áA RECOMPENSA (WIDGETS) */
        .widget-container { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px; }
        @media (min-width: 768px) { .widget-container { grid-template-columns: 1fr 1fr; } }
        
        .task-widget { 
            background: var(--card-bg); border-radius: 12px; padding: 25px; 
            display: flex; align-items: center; justify-content: space-between; border: 1px solid #222;
        }
        .btn-action { 
            background: var(--gold); color: #000; border: none; padding: 10px 24px; 
            border-radius: 6px; font-weight: 700; cursor: pointer; font-size: 0.8rem;
            transition: 0.2s;
        }
        .btn-action:active { transform: scale(0.95); }

        /* AUTH TELA */
        .auth-screen { max-width: 420px; margin: 100px auto; padding: 40px; background: var(--card-bg); border-radius: 20px; border: 1px solid #222; text-align: center; }
        input { width: 100%; padding: 14px; margin: 10px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; }
    </style>
</head>
<body>

<div id="authPanel">
    <div class="auth-screen">
        <div class="brand-circle" style="width:80px; height:80px;">
            <img src="https://i.ibb.co/LhqZz1L/mam-logo.jpg">
        </div>
        <h2 style="margin: 20px 0;">MAM Distribuidora</h2>
        <input type="email" id="email" placeholder="E-mail">
        <input type="password" id="pass" placeholder="Palavra-passe">
        <button class="btn-action" style="width:100%; margin-top:10px;" onclick="logar()">ENTRAR NO PAINEL</button>
        <p style="font-size: 0.75rem; margin-top: 20px; color: #666;">Assist√™ncia: mamfilhos29@gmail.com [cite: 2026-01-28]</p>
    </div>
</div>

<div id="mainDashboard" class="hidden">
    <header>
        <div class="user-profile-top">
            <img src="" id="topUserImg">
            <span>Ol√°, <b id="topUserName">Matias</b></span>
        </div>
        <div class="header-search">
            <input type="text" placeholder="Pesquisar discos, artistas ou produtores...">
        </div>
        <div id="totalBalance" style="color: var(--gold); font-weight: 800; font-size: 1rem;">0,00 Kz</div>
    </header>

    <div class="app-container">
        <aside class="sidebar">
            <div class="brand-box">
                <div class="brand-circle">
                    <img src="https://i.ibb.co/LhqZz1L/mam-logo.jpg">
                </div>
                <h3 style="font-size: 1.1rem; color: var(--gold);">MAM Digital</h3>
            </div>
            
            <nav class="nav-menu">
                <li class="nav-item active" onclick="nav('home')">üè† P√°gina Inicial</li>
                <li class="nav-item" onclick="nav('perfil')">üë§ Meu Perfil</li>
                <li class="nav-item" onclick="nav('artista')">üë®‚Äçüé® Criar Artista</li>
                <li class="nav-item" onclick="nav('lancar')">üì§ Lan√ßar M√∫sica</li>
                <li class="nav-item" onclick="nav('minhas')">üé∂ Minhas M√∫sicas</li>
                <li class="nav-item" onclick="nav('carteira')">üí∞ Minha Carteira</li>
                <li class="nav-item" onclick="nav('ceo')">üëî Informa√ß√£o CEO</li>
                <li class="nav-item logout" onclick="sair()">üö™ Terminar Sess√£o</li>
            </nav>
        </aside>

        <main class="main-content">
            
            <section id="sHome">
                <div class="ceo-banner">
                    <h4 style="color: var(--gold); margin-bottom: 5px;">APOIA MEUS PROJECTOS</h4>
                    <p style="font-size: 0.75rem; opacity: 0.8;">IBAN BFA: AO06 0000 0000 0000 0000 0 | CEO: Matias Manuel [cite: 2026-01-27]</p>
                </div>

                <div class="section-header">Feed de Lan√ßamentos</div>
                <div class="vinyl-grid" id="discoContainer">
                    </div>

                <div class="section-header" style="margin-top: 50px;">Ca√ßa Recompensa</div>
                <div class="widget-container">
                    <div class="task-widget">
                        <div>
                            <p style="font-weight: 600;">Assistir V√≠deo Pago</p>
                            <p style="font-size: 0.7rem; color: #666;">Ganha b√≥nus imediato na carteira</p>
                        </div>
                        <button class="btn-action" onclick="alert('Iniciando player de an√∫ncios...')">ASSISTIR</button>
                    </div>
                    <div class="task-widget">
                        <div>
                            <p style="font-weight: 600;">Convidar Amigos</p>
                            <p style="font-size: 0.7rem; color: #666;">Ganha 500 Kz por cada novo registo</p>
                        </div>
                        <button class="btn-action" onclick="compartilharLink()">COPIAR LINK</button>
                    </div>
                </div>
            </section>

            <section id="sPerfil" class="hidden">
                <div class="section-header">Editar Meu Perfil</div>
                <div style="max-width: 500px; background: var(--card-bg); padding: 30px; border-radius: 15px;">
                    <label>Nome Art√≠stico:</label>
                    <input type="text" id="editNome">
                    <label style="margin-top: 15px; display: block;">Foto de Perfil (Dispositivo):</label>
                    <input type="file" id="upFoto" accept="image/*" onchange="previewImg()">
                    <button class="btn-action" style="width: 100%; margin-top: 20px;" onclick="salvarPerfil()">ATUALIZAR DADOS</button>
                </div>
            </section>

            <section id="sCarteira" class="hidden">
                <div class="section-header">Minha Carteira</div>
                <div style="background: var(--card-bg); padding: 40px; border-radius: 15px; text-align: center; border: 1px solid #222;">
                    <p style="color: #666; margin-bottom: 10px;">SALDO DISPON√çVEL</p>
                    <h1 id="saldoMain" style="font-size: 3.5rem; color: var(--gold);">0,00 Kz</h1>
                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
                        <button class="btn-action" onclick="alert('M√≠nimo para saque: 10.000 Kz')">LEVANTAR AGORA</button>
                    </div>
                </div>
            </section>

        </main>
    </div>
</div>

<script>
    // CONFIGURA√á√ÉO FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyBBsZS8EpszUtikaKS8B5te8C7Q9Ow-9wo",
        authDomain: "mam-distribuidora.firebaseapp.com",
        projectId: "mam-distribuidora",
        storageBucket: "mam-distribuidora.firebasestorage.app",
        messagingSenderId: "670857002452",
        appId: "1:670857002452:web:404822b5376075e520ea41"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(); const db = firebase.firestore();

    // LOGIN REAL
    async function logar() {
        const e = document.getElementById('email').value, p = document.getElementById('pass').value;
        try { await auth.signInWithEmailAndPassword(e, p); } catch(err) { alert("Credenciais inv√°lidas ou sem acesso."); }
    }

    // GEST√ÉO DE SESS√ÉO (MANT√âM LOGADO)
    auth.onAuthStateChanged(user => {
        if(user) {
            document.getElementById('authPanel').classList.add('hidden');
            document.getElementById('mainDashboard').classList.remove('hidden');
            
            db.collection("users").doc(user.uid).onSnapshot(doc => {
                if(doc.exists) {
                    const data = doc.data();
                    document.getElementById('topUserName').innerText = data.nome;
                    document.getElementById('totalBalance').innerText = data.saldo.toLocaleString() + " Kz";
                    document.getElementById('saldoMain').innerText = data.saldo.toLocaleString() + " Kz";
                    document.getElementById('topUserImg').src = data.foto || 'https://i.ibb.co/LhqZz1L/mam-logo.jpg';
                    document.getElementById('editNome').value = data.nome;
                }
            });
            carregarMusicas();
        } else {
            document.getElementById('authPanel').classList.remove('hidden');
            document.getElementById('mainDashboard').classList.add('hidden');
        }
    });

    // SISTEMA DE CONVITE REAL (GERA LINK √öNICO)
    function compartilharLink() {
        const userId = auth.currentUser.uid;
        // O link gerado usa a URL atual + o ID do usu√°rio para o convite
        const conviteLink = window.location.origin + "?ref=" + userId;
        
        navigator.clipboard.writeText(conviteLink).then(() => {
            alert("LINK COPIADO: " + conviteLink + "\nPartilha com amigos e ganha 500 Kz por cada registo!");
        });
    }

    // CARREGAR FEED DE M√öSICAS (DISCOS)
    function carregarMusicas() {
        db.collection("musicas").orderBy("data", "desc").onSnapshot(snap => {
            const container = document.getElementById('discoContainer');
            container.innerHTML = "";
            snap.forEach(doc => {
                const m = doc.data();
                container.innerHTML += `
                    <div class="vinyl-card">
                        <div class="vinyl-cover-wrapper">
                            <img src="${m.capa}">
                        </div>
                        <h4>${m.titulo}</h4>
                        <p>${m.artista}</p>
                    </div>`;
            });
        });
    }

    // NAVEGA√á√ÉO ENTRE OP√á√ïES DO MENU
    function nav(id) {
        document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
        document.getElementById('s' + id.charAt(0).toUpperCase() + id.slice(1)).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    // SALVAR PERFIL COM FOTO DO DISPOSITIVO
    let tempFoto = "";
    function previewImg() {
        const file = document.getElementById('upFoto').files[0];
        const reader = new FileReader();
        reader.onloadend = () => { tempFoto = reader.result; }
        if(file) reader.readAsDataURL(file);
    }

    async function salvarPerfil() {
        const n = document.getElementById('editNome').value;
        const up = { nome: n };
        if(tempFoto) up.foto = tempFoto;
        await db.collection("users").doc(auth.currentUser.uid).update(up);
        alert("Perfil atualizado com sucesso!");
    }

    function sair() { auth.signOut().then(() => location.reload()); }
</script>
</body>
</html>
