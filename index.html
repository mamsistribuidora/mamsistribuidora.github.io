<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAM Distribuidora | Elite System</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #D4AF37; --blue: #00BFFF; --card: rgba(10, 10, 10, 0.98); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
        
        body { 
            background: #000; color: #fff; height: 100vh; overflow: hidden;
            background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png'), radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
            background-attachment: fixed;
        }

        .hidden { display: none !important; }

        /* DESIGN DE ACESSO */
        #authArea { height: 100vh; display: flex; align-items: center; justify-content: center; z-index: 100; position: relative; }
        .mam-box { background: var(--card); padding: 50px; border-radius: 40px; border: 1px solid var(--gold); width: 100%; max-width: 450px; text-align: center; box-shadow: 0 0 50px #000; }
        .mam-logo { width: 90px; height: 90px; border: 3px solid var(--gold); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-weight: 800; color: var(--gold); font-size: 1.6rem; background: #000; }

        input, select, textarea { width: 100%; padding: 14px; margin: 10px 0; background: #080808; border: 1px solid #222; color: #fff; border-radius: 12px; border: 1px solid #333; }
        .btn-mam { width: 100%; padding: 16px; background: var(--gold); color: #000; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .btn-mam:hover { filter: brightness(1.2); transform: scale(1.02); }

        /* DASHBOARD GRID */
        #app { display: grid; grid-template-columns: 280px 1fr; height: 100vh; }
        aside { background: rgba(0,0,0,0.95); border-right: 1px solid #1a1a1a; padding: 30px 20px; display: flex; flex-direction: column; }
        main { overflow-y: auto; padding: 40px; background: rgba(0,0,0,0.2); padding-bottom: 100px; }

        .nav-item { padding: 15px 20px; color: #777; cursor: pointer; border-radius: 15px; margin-bottom: 5px; display: flex; align-items: center; gap: 15px; }
        .nav-item:hover, .active-nav { background: rgba(255,255,255,0.05); color: var(--gold); font-weight: 700; border-left: 4px solid var(--gold); }
        .btn-sair { margin-top: auto; color: #ff3333; padding: 15px; text-align: center; cursor: pointer; font-weight: bold; border-top: 1px solid #222; }

        /* SELO VERIFICADO */
        .verified-badge { color: var(--blue); font-size: 0.9rem; margin-left: 5px; }

        /* CARTEIRA E VERIFICA√á√ÉO */
        .premium-card { background: linear-gradient(135deg, #111 0%, #050505 100%); padding: 30px; border-radius: 25px; border: 1px solid #222; margin-top: 20px; text-align: center; }
        .btn-verify { background: var(--blue); color: #fff; padding: 10px 20px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 15px; }

        /* CHAT BOX */
        #chatBox { background: #0a0a0a; height: 250px; overflow-y: auto; border: 1px solid #222; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 10px; max-width: 80%; font-size: 0.8rem; }
        .msg.user { background: #1a1a1a; align-self: flex-start; }
        .msg.ceo { background: var(--gold); color: #000; align-self: flex-end; font-weight: bold; }

        /* TAREFA */
        #timerDisplay { font-size: 3rem; font-weight: 800; color: var(--gold); margin: 15px 0; }

        footer { position: fixed; bottom: 0; right: 0; width: calc(100% - 280px); padding: 15px; background: #000; border-top: 1px solid #1a1a1a; text-align: center; color: var(--gold); font-size: 0.7rem; letter-spacing: 2px; }
    </style>
</head>
<body>

<div id="authArea">
    <div class="mam-box">
        <div class="mam-logo">MAM</div>
        <h2 id="aT" style="color:var(--gold)">PAINEL MAM</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="pass" placeholder="Senha">
        <input type="password" id="cPass" class="hidden" placeholder="Confirmar Senha">
        <button class="btn-mam" onclick="authMAM()" id="btnA">ENTRAR</button>
        <p onclick="toggleA()" id="tA" style="margin-top:20px; cursor:pointer; color:var(--gold); font-size:0.8rem;">Novo Artista? <b>Criar Conta</b></p>
    </div>
</div>

<div id="app" class="hidden">
    <aside>
        <div class="mam-logo" style="transform: scale(0.7); margin-bottom: 20px;">MAM</div>
        <div class="nav-item active-nav" onclick="tab('Home', this)">üè† Pagina Inicial</div>
        <div class="nav-item" onclick="tab('Perfil', this)">üë§ Meu Perfil</div>
        <div class="nav-item" onclick="tab('Lancar', this)">üì§ Lan√ßa M√∫sica</div>
        <div class="nav-item" onclick="tab('Cart', this)">üí∞ Minha Carteira</div>
        <div class="nav-item" onclick="tab('Chat', this)">üí¨ Suporte CEO</div>
        <div class="nav-item hidden" id="navAdmin" onclick="tab('Admin', this)">‚öôÔ∏è Administra√ß√£o</div>
        <div class="btn-sair" onclick="sair()">SAIR DA CONTA</div>
    </aside>

    <main>
        <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <h2 id="uNameDisplay" style="color:var(--gold)">CARREGANDO...</h2>
            <div id="uSaldoTopo" style="background:#111; padding:10px 20px; border-radius:30px; border:1px solid var(--gold); font-weight:bold; color:var(--gold);">0 Kz</div>
        </header>

        <div id="pHome" class="aba">
            <div style="background:var(--card); padding:30px; border-radius:25px; text-align:center; border:1px solid #222;">
                <h3 style="color:var(--gold)">üéØ TAREFA RECOMPENSADA</h3>
                <div id="timerDisplay">30s</div>
                <button class="btn-mam" id="btnT" onclick="iniciarTarefa()" style="width:200px">ASSISTIR V√çDEO</button>
            </div>
            <h3 style="margin-top:30px; color:var(--gold)">üìÄ Feed de Lan√ßamentos</h3>
            <div id="fGlobal" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:20px; margin-top:15px;"></div>
        </div>

        <div id="pCart" class="aba hidden">
            <div style="background:var(--card); padding:40px; border-radius:25px; border-left:8px solid var(--gold);">
                <p>Saldo da Conta (Kz)</p>
                <h1 id="uSaldoBig" style="color:var(--gold); font-size:3.5rem;">0 Kz</h1>
                <button class="btn-mam" style="width:200px; margin-top:15px;">LEVANTAR AGORA</button>
            </div>

            <div class="premium-card">
                <h3 style="color:var(--blue)">Selo de Verificado MAM üîµ</h3>
                <p style="font-size:0.8rem; color:#888; margin-top:5px;">Torna-te um artista oficial e ganha prioridade nos lan√ßamentos.</p>
                <p style="margin-top:10px; font-weight:bold;">Pre√ßo: 25.000 Kz</p>
                <button class="btn-verify" onclick="comprarVerificado()">ADQUIRIR SELO AZUL</button>
            </div>
        </div>

        <div id="pChat" class="aba hidden">
            <h3 style="color:var(--gold); margin-bottom:15px;">üí¨ Canal Direto com o CEO</h3>
            <div id="chatBox"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="chatIn" placeholder="Escreve aqui...">
                <button class="btn-mam" style="width:100px; margin:0;" onclick="enviarMsg()">ENVIAR</button>
            </div>
        </div>

        <div id="pAdmin" class="aba hidden">
            <h2 style="color:var(--gold)">PAINEL HQ CEO</h2>
            <div id="admLogs" style="margin-top:20px; background: #111; padding: 20px; border-radius: 15px; font-size: 0.8rem; color: #888;">
                A monitorizar cofres da MAM em tempo real...
            </div>
        </div>
    </main>
</div>

<footer>MAM DISTRIBUIDORA | MATIAS ARS√âNIO MANUEL</footer>

<script>
    const cfg = { apiKey: "AIzaSyBBsZS8EpszUtikaKS8B5te8C7Q9Ow-9wo", authDomain: "mam-distribuidora.firebaseapp.com", projectId: "mam-distribuidora", storageBucket: "mam-distribuidora.appspot.com", messagingSenderId: "670857002452", appId: "1:670857002452:web:404822b5376075e520ea41" };
    firebase.initializeApp(cfg);
    const auth = firebase.auth(), db = firebase.firestore();

    let isL = true;
    const CEO_EMAIL = "mamfilhos24@gmail.com";

    function toggleA() {
        isL = !isL;
        document.getElementById('aT').innerText = isL ? "PAINEL MAM" : "CRIAR CONTA";
        document.getElementById('cPass').classList.toggle('hidden', isL);
        document.getElementById('btnA').innerText = isL ? "ENTRAR" : "REGISTAR";
    }

    async function authMAM() {
        const e = document.getElementById('email').value, p = document.getElementById('pass').value;
        try {
            if(isL) {
                await auth.signInWithEmailAndPassword(e, p);
                db.collection("lucro_mam").add({ valor: 3000, mot: "Login: "+e, data: new Date() });
            } else {
                const r = await auth.createUserWithEmailAndPassword(e, p);
                await db.collection("users").doc(r.user.uid).set({ email: e, saldo: 1000, verificado: false, uid: r.user.uid });
                db.collection("lucro_mam").add({ valor: 5000, mot: "Nova Conta: "+e, data: new Date() });
            }
        } catch(err) { alert(err.message); }
    }

    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('authArea').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            if(u.email === CEO_EMAIL) document.getElementById('navAdmin').classList.remove('hidden');
            
            db.collection("users").doc(u.uid).onSnapshot(d => {
                const data = d.data();
                const selo = data.verificado ? ' <span class="verified-badge">üîµ</span>' : '';
                document.getElementById('uNameDisplay').innerHTML = u.email.split('@')[0].toUpperCase() + selo;
                document.getElementById('uSaldoTopo').innerText = data.saldo.toLocaleString() + " Kz";
                document.getElementById('uSaldoBig').innerText = data.saldo.toLocaleString() + " Kz";
            });
            ouvirChat();
        } else {
            document.getElementById('authArea').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
        }
    });

    async function comprarVerificado() {
        const u = auth.currentUser.uid;
        const ref = db.collection("users").doc(u);
        const d = await ref.get();
        if(d.data().saldo >= 25000) {
            await ref.update({ saldo: firebase.firestore.FieldValue.increment(-25000), verificado: true });
            db.collection("lucro_mam").add({ valor: 25000, mot: "Compra Selo Azul", data: new Date() });
            alert("Parab√©ns! Agora √©s um Artista Verificado na MAM! üîµ");
        } else {
            alert("Saldo insuficiente. Precisas de 25.000 Kz.");
        }
    }

    function iniciarTarefa() {
        let t = 30;
        const b = document.getElementById('btnT');
        const d = document.getElementById('timerDisplay');
        b.disabled = true;
        const clock = setInterval(async () => {
            t--; d.innerText = t + "s";
            if(t <= 0) {
                clearInterval(clock); d.innerText = "30s"; b.disabled = false;
                await db.collection("users").doc(auth.currentUser.uid).update({ saldo: firebase.firestore.FieldValue.increment(500) });
                db.collection("lucro_mam").add({ valor: 2000, mot: "Comiss√£o V√≠deo", data: new Date() });
                alert("Tarefa Completa! 500 Kz adicionados.");
            }
        }, 1000);
    }

    async function enviarMsg() {
        const txt = document.getElementById('chatIn').value;
        if(!txt) return;
        await db.collection("chats").add({
            texto: txt, user: auth.currentUser.email,
            data: new Date(), tipo: auth.currentUser.email === CEO_EMAIL ? "ceo" : "user"
        });
        document.getElementById('chatIn').value = "";
    }

    function ouvirChat() {
        db.collection("chats").orderBy("data", "asc").onSnapshot(snap => {
            const box = document.getElementById('chatBox'); box.innerHTML = "";
            snap.forEach(doc => {
                const m = doc.data();
                box.innerHTML += `<div class="msg ${m.tipo}">${m.texto}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    function tab(id, el) {
        document.querySelectorAll('.aba').forEach(a => a.classList.add('hidden'));
        document.getElementById('p' + id).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
        el.classList.add('active-nav');
    }

    function sair() { auth.signOut(); }
</script>
</body>
</html>
