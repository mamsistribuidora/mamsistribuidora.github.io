<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAM Distribuidora | Oficial</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root { --gold: #D4AF37; --bright: #FFD700; --dark: #0a0a0a; --glass: rgba(20,20,20,0.95); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background: #000; color: #fff; overflow-x: hidden; }
        
        .hidden { display: none !important; }
        .btn { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.3s; }

        /* Barra de Navega√ß√£o */
        nav { background: var(--glass); border-bottom: 2px solid var(--gold); padding: 15px; position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; }
        .search-bar { background: #111; border: 1px solid #333; padding: 8px; border-radius: 20px; color: #fff; width: 250px; }

        /* Menu Lateral Estilizado */
        .sidebar { width: 260px; background: #050505; height: 100vh; position: fixed; left: 0; border-right: 1px solid #222; padding: 20px; }
        .menu-item { padding: 12px; color: #aaa; cursor: pointer; display: block; text-decoration: none; border-radius: 5px; margin-bottom: 5px; }
        .menu-item:hover { background: var(--gold); color: #000; }

        /* Conte√∫do Principal */
        main { margin-left: 270px; padding: 20px; }

        /* Grid de Discos (M√∫sicas) */
        .grid-musicas { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .disco { background: #111; border-radius: 10px; padding: 10px; border: 1px solid #222; text-align: center; transition: 0.3s; cursor: pointer; }
        .disco:hover { border-color: var(--gold); transform: scale(1.05); }
        .capa { width: 100%; aspect-ratio: 1/1; border-radius: 5px; background: #222; object-fit: cover; }
        .disco h4 { font-size: 0.9rem; margin-top: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Carteira e Ganhos */
        .card-wallet { background: linear-gradient(135deg, #111, #222); border: 1px solid var(--gold); padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        .balance-kz { font-size: 2rem; color: var(--bright); font-weight: bold; }

        /* Ads e Recompensas */
        .ads-section { margin-top: 30px; background: #0a0a1a; padding: 15px; border-radius: 10px; border-left: 5px solid #00f; }

        /* Player Fixo */
        .player-bar { position: fixed; bottom: 0; width: 100%; background: #000; border-top: 2px solid var(--gold); padding: 15px; display: flex; align-items: center; z-index: 2000; }

        /* Formul√°rios */
        .form-group { margin-bottom: 15px; }
        input, select { width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 5px; }
    </style>
</head>
<body>

<div id="authScreen" class="overlay" style="display: flex; align-items: center; justify-content: center; height: 100vh; background: url('https://images.unsplash.com/photo-1470225620780-dba8ba36b745?auto=format&fit=crop&w=1200&q=80'); background-size: cover;">
    <div style="background: rgba(0,0,0,0.9); padding: 40px; border-radius: 20px; border: 2px solid var(--gold); width: 100%; max-width: 400px; text-align: center;">
        <h1 style="color:var(--bright)">MAM</h1>
        <p id="authMsg" style="margin-bottom: 20px; font-size: 0.8rem; color: #888;">Distribui√ß√£o Profissional Angolana</p>
        
        <div id="loginForm">
            <input type="email" id="email" placeholder="E-mail" style="margin-bottom: 10px;">
            <input type="password" id="pass" placeholder="Senha" style="margin-bottom: 10px;">
            <button class="btn" onclick="login()" style="width:100%; padding:15px; background:var(--gold); color:#000;">INICIAR SESS√ÉO</button>
            <p onclick="toggleAuth(true)" style="margin-top:15px; font-size:0.8rem; cursor:pointer; color:var(--gold)">Ainda n√£o tem conta? Registar</p>
        </div>

        <div id="regForm" class="hidden">
            <input type="text" id="regNome" placeholder="Nome Art√≠stico" style="margin-bottom: 10px;">
            <input type="email" id="regEmail" placeholder="E-mail" style="margin-bottom: 10px;">
            <input type="password" id="regPass" placeholder="Senha (6+ d√≠gitos)" style="margin-bottom: 10px;">
            <input type="password" id="regPassConf" placeholder="Confirmar Senha" style="margin-bottom: 10px;">
            <button class="btn" onclick="registrar()" style="width:100%; padding:15px; background:var(--gold); color:#000;">CRIAR CONTA</button>
            <p onclick="toggleAuth(false)" style="margin-top:15px; font-size:0.8rem; cursor:pointer; color:var(--gold)">J√° tenho conta</p>
        </div>
    </div>
</div>

<div id="appScreen" class="hidden">
    <nav>
        <h2 style="color:var(--gold)">MAM</h2>
        <input type="text" class="search-bar" placeholder="üîç Pesquisar m√∫sica ou artista...">
        <div id="userInfo" style="font-size: 0.8rem;"></div>
    </nav>

    <div class="sidebar">
        <a class="menu-item" onclick="showPage('home')">üè† P√°gina Inicial</a>
        <a class="menu-item" onclick="showPage('perfil')">üë§ Meu Perfil</a>
        <a class="menu-item" onclick="showPage('artista')">üé§ Criar Artista/Produtor</a>
        <a class="menu-item" onclick="showPage('lancar')">üì§ Lan√ßar M√∫sica</a>
        <a class="menu-item" onclick="showPage('carteira')">üí∞ Minha Carteira</a>
        <a class="menu-item" onclick="showPage('ceo')">üëî Info CEO</a>
        <a class="menu-item" onclick="logout()" style="color: red; margin-top: 20px;">üö™ Sair</a>
    </div>

    <main>
        <section id="pageHome">
            <h3 style="margin-bottom: 20px;">üéµ Lan√ßamentos Recentes</h3>
            <div class="grid-musicas" id="feedMusicas">
                </div>

            <div class="ads-section">
                <h4>üéØ Desafios Ca√ßa Recompensa</h4>
                <p style="font-size: 0.8rem;">Assista v√≠deos e ganhe at√© 70% do valor!</p>
                <div id="tasksList"></div>
            </div>
        </section>

        <section id="pageCarteira" class="hidden">
            <div class="card-wallet">
                <p>Saldo Atual (Kwanza)</p>
                <div class="balance-kz" id="valKz">0,00 Kz</div>
                <p id="valUsd" style="color: #666;">$ 0.00</p>
            </div>
            <h4>Levantamento</h4>
            <select id="metodoSaque" style="margin-top:10px;">
                <option>IBAN (BAI, BFA, BIC)</option>
                <option>Multicaixa Express</option>
                <option>PayPal</option>
                <option>PIX (Brasil)</option>
            </select>
            <input type="number" id="quantiaSaque" placeholder="Valor (M√≠n. 10.000 Kz)" style="margin-top:10px;">
            <button class="btn" style="background:var(--success); color:white; padding:15px; margin-top:10px;" onclick="solicitarSaque()">SOLICITAR SAQUE</button>
        </section>

        <section id="pageCeo" class="hidden">
            <h3>üëî CEO Matias Ars√©nio Manuel</h3>
            <p>Siga o TikTok do CEO: <strong>@Play Sean Arsenio</strong></p>
            <div id="ceoSocial" style="margin-top:20px;">
                </div>
        </section>
    </main>

    <div class="player-bar">
        <div id="playerInfo" style="display:flex; align-items:center; gap:15px;">
            <img id="playerCapa" src="" style="width:50px; height:50px; border-radius:5px; background:#333;">
            <div>
                <b id="playerTitle">Selecione uma m√∫sica</b><br>
                <small id="playerArtist">-</small>
            </div>
        </div>
        <audio id="mainAudio" controls style="margin-left:auto;"></audio>
    </div>
</div>

<script>
    // Configura√ß√µes do Matias
    const firebaseConfig = {
        apiKey: "AIzaSyBBsZS8EpszUtikaKS8B5te8C7Q9Ow-9wo",
        authDomain: "mam-distribuidora.firebaseapp.com",
        projectId: "mam-distribuidora",
        storageBucket: "mam-distribuidora.firebasestorage.app",
        messagingSenderId: "670857002452",
        appId: "1:670857002452:web:404822b5376075e520ea41"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Persist√™ncia de Sess√£o
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

    // Controle de Telas
    function showPage(p) {
        document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
        document.getElementById('page'+p.charAt(0).toUpperCase()+p.slice(1)).classList.remove('hidden');
    }

    function toggleAuth(reg) {
        document.getElementById('loginForm').classList.toggle('hidden', reg);
        document.getElementById('regForm').classList.toggle('hidden', !reg);
    }

    // REGISTO COM EMAIL DE CONFIRMA√á√ÉO
    async function registrar() {
        const email = document.getElementById('regEmail').value;
        const pass = document.getElementById('regPass').value;
        const nome = document.getElementById('regNome').value;

        try {
            const res = await auth.createUserWithEmailAndPassword(email, pass);
            await res.user.sendEmailVerification();
            
            // Criar Perfil na DB
            await db.collection("usuarios").doc(res.user.uid).set({
                nome: nome,
                email: email,
                nivel: "normal",
                saldo: 0,
                seguidores: 0,
                isAdmin: email === "mamfilhos24@gmail.com"
            });

            alert("Verifique o seu e-mail para confirmar a conta MAM!");
            logout();
        } catch(e) { alert(e.message); }
    }

    // LOGIN
    async function login() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('pass').value;
        try {
            const res = await auth.signInWithEmailAndPassword(e, p);
            if(!res.user.emailVerified && e !== "mamfilhos24@gmail.com") {
                alert("Por favor, confirme o seu e-mail primeiro.");
                logout();
            }
        } catch(e) { alert(e.message); }
    }

    // MONITOR DE SESS√ÉO
    auth.onAuthStateChanged(user => {
        if(user && (user.emailVerified || user.email === "mamfilhos24@gmail.com")) {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');
            carregarDados(user);
            setInterval(alertaTiktok, 300000); // 5 min
        } else {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('appScreen').classList.add('hidden');
        }
    });

    async function carregarDados(user) {
        const doc = await db.collection("usuarios").doc(user.uid).get();
        const data = doc.data();
        document.getElementById('userInfo').innerText = `Ol√°, ${data.nome} | ${data.nivel.toUpperCase()}`;
        document.getElementById('valKz').innerText = data.saldo.toLocaleString('pt-AO') + " Kz";
        
        // Convers√£o autom√°tica (Ex: 1 USD = 950 Kz)
        document.getElementById('valUsd').innerText = "$ " + (data.saldo / 950).toFixed(2);
        
        carregarMusicas();
    }

    function carregarMusicas() {
        const feed = document.getElementById('feedMusicas');
        // Exemplo de M√∫sica fixa para teste conforme pedido
        const musicas = [
            {titulo: "Princesa Heliany", artista: "Play Sean Arsenio", capa: "https://via.placeholder.com/150", url: "SUA_URL_AUDIO"}
        ];
        
        feed.innerHTML = "";
        musicas.forEach(m => {
            feed.innerHTML += `
                <div class="disco" onclick="playMusic('${m.url}', '${m.titulo}', '${m.artista}', '${m.capa}')">
                    <img src="${m.capa}" class="capa">
                    <h4>${m.titulo}</h4>
                    <small>${m.artista}</small>
                </div>
            `;
        });
    }

    function playMusic(url, title, artist, img) {
        const audio = document.getElementById('mainAudio');
        document.getElementById('playerTitle').innerText = title;
        document.getElementById('playerArtist').innerText = artist;
        document.getElementById('playerCapa').src = img;
        audio.src = url;
        audio.play();
        
        // Ganho por Stream (MAM ganha 2000)
        console.log("MAM ganhou 2000 Kz por este stream.");
    }

    function alertaTiktok() {
        if(confirm("Siga o CEO Play Sean Arsenio no TikTok para novidades! Abrir agora?")) {
