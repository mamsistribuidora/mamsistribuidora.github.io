<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAM Distribuidora | Lite</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <style>
        :root { --gold: #D4AF37; --dark: #000; --gray: #111; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background: var(--dark); color: #fff; font-size: 14px; }
        .hidden { display: none !important; }
        
        /* HEADER FIXO */
        header { background: #000; padding: 12px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; position: sticky; top: 0; z-index: 9; }
        .user-info { display: flex; align-items: center; gap: 8px; }
        .user-info img { width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--gold); }

        /* MENU LATERAL SLIM */
        .wrapper { display: flex; }
        .sidebar { width: 60px; background: #000; border-right: 1px solid #222; height: calc(100vh - 55px); transition: 0.3s; }
        @media (min-width: 768px) { .sidebar { width: 220px; } .sidebar span { display: inline !important; } }
        .sidebar span { display: none; }
        
        .nav-link { padding: 15px; color: #888; cursor: pointer; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid #0a0a0a; }
        .nav-link:hover, .active { color: var(--gold); background: var(--gray); font-weight: bold; }

        /* CONTE√öDO LEVE */
        .content { flex: 1; padding: 15px; overflow-y: auto; }
        .card { background: var(--gray); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; }
        input, select { width: 100%; padding: 10px; margin: 5px 0 15px; background: #000; border: 1px solid #333; color: #fff; border-radius: 5px; }
        .btn { background: var(--gold); color: #000; border: none; padding: 12px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; }

        /* FEED VINIL */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 15px; }
        .vinyl { text-align: center; }
        .vinyl img { width: 100%; aspect-ratio: 1/1; border-radius: 50%; border: 3px solid #1a1a1a; box-shadow: 0 4px 10px #000; }
    </style>
</head>
<body>

<div id="authArea">
    <div style="max-width:350px; margin: 100px auto; padding: 20px; text-align: center;">
        <img src="https://i.ibb.co/LhqZz1L/mam-logo.jpg" style="width:80px; border-radius:50%; border:2px solid var(--gold);">
        <h2 style="margin: 15px 0;">MAM Login</h2>
        <input type="email" id="e" placeholder="Email">
        <input type="password" id="p" placeholder="Senha">
        <button class="btn" onclick="login()">ENTRAR</button>
    </div>
</div>

<div id="appArea" class="hidden">
    <header>
        <div class="user-info"><img id="hImg" src=""> <span id="hNome"></span></div>
        <div id="hSaldo" style="color:var(--gold); font-weight:bold;">0 Kz</div>
    </header>

    <div class="wrapper">
        <aside class="sidebar">
            <div class="nav-link active" onclick="tab('Home')">üè† <span>In√≠cio</span></div>
            <div class="nav-link" onclick="tab('Perfil')">üë§ <span>Perfil</span></div>
            <div class="nav-link" onclick="tab('Artista')">üë®‚Äçüé® <span>Artistas</span></div>
            <div class="nav-link" onclick="tab('Lancar')">üì§ <span>Lan√ßar</span></div>
            <div class="nav-link" onclick="tab('Minhas')">üé∂ <span>Cat√°logo</span></div>
            <div class="nav-link" onclick="tab('Carteira')">üí∞ <span>Carteira</span></div>
            <div class="nav-link" onclick="tab('Ceo')">üëî <span>CEO</span></div>
            <div class="nav-link" onclick="sair()" style="color:red;">üö™ <span>Sair</span></div>
        </aside>

        <main class="content">
            <section id="sHome">
                <div class="grid" id="feed"></div>
                <button class="btn" style="margin-top:20px; background:#111; color:var(--gold);" onclick="copiar()">üîó COPIAR LINK CONVITE</button>
            </section>

            <section id="sLancar" class="hidden">
                <div class="card">
                    <input type="text" id="mT" placeholder="T√≠tulo">
                    <input type="text" id="mA" placeholder="Artista/Feat">
                    <select id="mG"><option>Kizomba</option><option>Kuduro</option><option>Hip-Hop</option></select>
                    <label>Capa:</label><input type="file" id="mC" accept="image/*">
                    <label>M√∫sica:</label><input type="file" id="mM" accept="audio/*">
                    <button class="btn" id="btnS" onclick="subir()">PUBLICAR</button>
                    <div id="prog" style="color:var(--gold); margin-top:10px; text-align:center;"></div>
                </div>
            </section>

            <section id="sPerfil" class="hidden">
                <div class="card">
                    <center><img id="pPre" style="width:100px; height:100px; border-radius:50%; border:2px solid var(--gold);"></center>
                    <input type="text" id="pNome">
                    <button class="btn" onclick="salvarP()">SALVAR PERFIL</button>
                </div>
            </section>

            <section id="sCarteira" class="hidden">
                <div class="card" style="text-align:center;">
                    <p>SALDO</p>
                    <h1 id="sVal" style="font-size:3rem; color:var(--gold);">0 Kz</h1>
                    <button class="btn" style="margin-top:20px;">LEVANTAR (EXPRESS)</button>
                </div>
            </section>

            <section id="sCeo" class="hidden">
                <div class="card" style="text-align:center;">
                    <img src="https://i.ibb.co/LhqZz1L/mam-logo.jpg" style="width:60px; border-radius:50%;">
                    <h3>Matias Manuel</h3>
                    <p>937881307</p>
                    <button class="btn" style="margin-top:10px;" onclick="window.open('https://wa.me/244937881307')">WHATSAPP</button>
                </div>
            </section>
        </main>
    </div>
</div>

<script>
    // FIREBASE
    const config = { apiKey: "AIzaSyBBsZS8EpszUtikaKS8B5te8C7Q9Ow-9wo", authDomain: "mam-distribuidora.firebaseapp.com", projectId: "mam-distribuidora", storageBucket: "mam-distribuidora.appspot.com", messagingSenderId: "670857002452", appId: "1:670857002452:web:404822b5376075e520ea41" };
    firebase.initializeApp(config);
    const auth = firebase.auth(), db = firebase.firestore(), st = firebase.storage();

    async function login() { 
        try { await auth.signInWithEmailAndPassword(document.getElementById('e').value, document.getElementById('p').value); } catch { alert("Erro!"); } 
    }

    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('authArea').classList.add('hidden');
            document.getElementById('appArea').classList.remove('hidden');
            db.collection("users").doc(u.uid).onSnapshot(d => {
                const data = d.data();
                document.getElementById('hNome').innerText = data.nome;
                document.getElementById('hSaldo').innerText = data.saldo + " Kz";
                document.getElementById('sVal').innerText = data.saldo + " Kz";
                document.getElementById('hImg').src = data.foto || 'https://i.ibb.co/LhqZz1L/mam-logo.jpg';
                document.getElementById('pPre').src = data.foto || 'https://i.ibb.co/LhqZz1L/mam-logo.jpg';
                document.getElementById('pNome').value = data.nome;
            });
            load();
        }
    });

    async function subir() {
        const t = document.getElementById('mT').value, c = document.getElementById('mC').files[0], m = document.getElementById('mM').files[0];
        if(!t || !c || !m) return alert("Faltam ficheiros!");
        document.getElementById('btnS').disabled = true;
        
        const cr = st.ref(`c/${Date.now()}`), ar = st.ref(`a/${Date.now()}`);
        await cr.put(c); const cu = await cr.getDownloadURL();
        const task = ar.put(m);
        task.on('state_changed', s => { document.getElementById('prog').innerText = Math.round((s.bytesTransferred/s.totalBytes)*100) + "%"; }, null, async () => {
            await db.collection("musicas").add({ titulo: t, capa: cu, artista: document.getElementById('mA').value, uid: auth.currentUser.uid, data: new Date() });
            alert("Sucesso!"); location.reload();
        });
    }

    function load() {
        db.collection("musicas").orderBy("data","desc").onSnapshot(s => {
            const f = document.getElementById('feed'); f.innerHTML = "";
            s.forEach(doc => { f.innerHTML += `<div class="vinyl"><img src="${doc.data().capa}"><p>${doc.data().titulo}</p></div>`; });
        });
    }

    function tab(id) {
        document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
        document.getElementById('s' + id).classList.remove('hidden');
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    function copiar() { navigator.clipboard.writeText(window.location.origin + "/?ref=" + auth.currentUser.uid); alert("
