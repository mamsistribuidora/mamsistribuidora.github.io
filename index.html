<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAM Distribuidora | Painel Administrativo de Elite</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #D4AF37; --card: rgba(10, 10, 10, 0.98); --glass: rgba(255, 255, 255, 0.03); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
        
        body { 
            background: #000; color: #fff; height: 100vh; overflow: hidden;
            background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png'), radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
            background-attachment: fixed;
        }

        .hidden { display: none !important; }

        /* LOGIN BOX LUXURY */
        #authArea { height: 100vh; display: flex; align-items: center; justify-content: center; z-index: 100; position: relative; }
        .mam-box { background: var(--card); padding: 50px; border-radius: 40px; border: 1px solid var(--gold); width: 100%; max-width: 450px; text-align: center; box-shadow: 0 0 100px rgba(0,0,0,1); }
        .mam-logo-hq { width: 100px; height: 100px; border: 4px solid var(--gold); border-radius: 50%; margin: 0 auto 25px; display: flex; align-items: center; justify-content: center; font-weight: 800; color: var(--gold); font-size: 1.8rem; background: #000; box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); }

        input, select, textarea { width: 100%; padding: 15px; margin: 10px 0; background: #080808; border: 1px solid #222; color: #fff; border-radius: 12px; outline: none; }
        input:focus { border-color: var(--gold); }
        .btn-mam { width: 100%; padding: 18px; background: var(--gold); color: #000; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        .btn-mam:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(212, 175, 55, 0.5); }

        /* DASHBOARD ADMIN E USU√ÅRIO */
        #app { display: grid; grid-template-columns: 300px 1fr; height: 100vh; }
        aside { background: rgba(0,0,0,0.95); border-right: 1px solid #1a1a1a; padding: 40px 20px; display: flex; flex-direction: column; }
        main { overflow-y: auto; padding: 40px; background: rgba(0,0,0,0.2); padding-bottom: 100px; }

        .nav-item { padding: 16px 20px; color: #777; cursor: pointer; border-radius: 15px; margin-bottom: 8px; display: flex; align-items: center; gap: 15px; transition: 0.4s; }
        .nav-item:hover, .active-nav { background: var(--glass); color: var(--gold); font-weight: 700; border-left: 4px solid var(--gold); }
        .btn-sair { margin-top: auto; color: #ff3333; padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; font-weight: bold; border: 1px solid rgba(255,51,51,0.2); }

        /* ESTATISTICAS ADMIN */
        .admin-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: var(--card); padding: 30px; border-radius: 25px; border: 1px solid #222; position: relative; overflow: hidden; }
        .stat-card::after { content: ""; position: absolute; top:0; right:0; width: 5px; height:100%; background: var(--gold); }
        .stat-card h4 { font-size: 0.8rem; color: #666; text-transform: uppercase; }
        .stat-card h2 { font-size: 2rem; color: var(--gold); margin-top: 10px; }

        /* TAREFA COM CONTADOR */
        .task-box { background: #0a0a0a; border: 2px solid #1a1a1a; padding: 30px; border-radius: 25px; text-align: center; margin-bottom: 30px; }
        #timerDisplay { font-size: 4rem; font-weight: 800; color: var(--gold); margin: 20px 0; font-variant-numeric: tabular-nums; }
        .video-placeholder { width: 100%; height: 200px; background: #000; border-radius: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; border: 1px dashed #333; }

        /* M√öSICAS DISCO HQ */
        .music-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 30px; }
        .vinyl-case { background: #0f0f0f; padding: 15px; border-radius: 25px; text-align: center; border: 1px solid #1a1a1a; transition: 0.5s; cursor: pointer; }
        .vinyl-case:hover { transform: translateY(-10px) rotate(2deg); border-color: var(--gold); }
        .vinyl-disc { width: 100%; aspect-ratio: 1/1; border-radius: 50%; border: 6px solid #111; object-fit: cover; box-shadow: 0 15px 35px rgba(0,0,0,0.7); }

        footer { position: fixed; bottom: 0; right: 0; width: calc(100% - 300px); padding: 15px; background: #000; border-top: 1px solid #1a1a1a; text-align: center; color: var(--gold); font-size: 0.75rem; font-weight: 600; letter-spacing: 2px; }
    </style>
</head>
<body>

<div id="authArea">
    <div class="mam-box">
        <div class="mam-logo-hq">MAM</div>
        <h2 id="aT" style="color:var(--gold); margin-bottom:10px;">HQ CENTRAL</h2>
        <p style="color:#555; margin-bottom:30px; font-size:0.8rem;">GEST√ÉO DE DISTRIBUI√á√ÉO E LUCROS</p>
        <input type="email" id="email" placeholder="Email do Artista ou Admin">
        <input type="password" id="pass" placeholder="Palavra-passe">
        <input type="password" id="cPass" class="hidden" placeholder="Confirmar Senha">
        <button class="btn-mam" onclick="authMAM()" id="btnA">ENTRAR NO SISTEMA</button>
        <p onclick="toggleA()" id="tA" style="margin-top:25px; cursor:pointer; color:var(--gold); font-size:0.85rem;">Novo na MAM? <b>Criar Conta de Elite</b></p>
    </div>
</div>

<div id="app" class="hidden">
    <aside>
        <div class="mam-logo-hq" style="transform: scale(0.7); margin-bottom: 30px;">MAM</div>
        <div class="nav-item active-nav" onclick="tab('Home', this)">üè† Pagina Inicial</div>
        <div class="nav-item" onclick="tab('Perfil', this)">üë§ Meu Perfil</div>
        <div class="nav-item" onclick="tab('Art', this)">üéôÔ∏è Criar Artista</div>
        <div class="nav-item" onclick="tab('Lancar', this)">üì§ Lan√ßa M√∫sica</div>
        <div class="nav-item" onclick="tab('Minhas', this)">üé∂ Minhas M√∫sicas</div>
        <div class="nav-item" onclick="tab('Cart', this)">üí∞ Minha Carteira</div>
        <div class="nav-item" onclick="tab('Admin', this)" id="navAdmin">‚öôÔ∏è Painel Administrativo</div>
        <div class="btn-sair" onclick="sair()">TERMINAR SESS√ÉO</div>
    </aside>

    <main>
        <div id="pAdmin" class="aba hidden">
            <h2 style="color:var(--gold); margin-bottom:30px;">üëî COMANDO CENTRAL CEO</h2>
            <div class="admin-stats">
                <div class="stat-card">
                    <h4>Cofre Total MAM</h4>
                    <h2 id="admCofre">0,00 Kz</h2>
                </div>
                <div class="stat-card">
                    <h4>Artistas Registados</h4>
                    <h2 id="admUsers">0</h2>
                </div>
                <div class="stat-card">
                    <h4>Distribui√ß√µes Ativas</h4>
                    <h2 id="admTracks">0</h2>
                </div>
            </div>
        </div>

        <div id="pHome" class="aba">
            <div class="task-box">
                <h3 style="color:var(--gold)">üéØ CA√áA RECOMPENSA: TAREFA DI√ÅRIA</h3>
                <p style="color:#666">Assiste ao v√≠deo completo para ganhar 500 Kz</p>
                <div id="timerDisplay">30s</div>
                <div class="video-placeholder">
                    <span style="color:#333">VIDEO_STREAM_MAM_AD</span>
                </div>
                <button class="btn-mam" id="btnTarefa" onclick="iniciarContagem()" style="width: auto; padding: 12px 40px;">INICIAR TAREFA</button>
            </div>

            <h3 style="color:var(--gold); margin-top:50px; margin-bottom:20px;">üìÄ √öLTIMOS LAN√áAMENTOS</h3>
            <div class="music-grid" id="fGlobal"></div>
        </div>

        <div id="pCart" class="aba hidden">
            <div style="background:var(--card); padding:50px; border-radius:30px; border-left:10px solid var(--gold);">
                <p style="color:#666; font-weight:bold;">SALDO DISPON√çVEL</p>
                <h1 id="uSaldoBig" style="color:var(--gold); font-size:4rem; font-weight:800;">0,00 Kz</h1>
                <div style="margin-top:30px; display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <button class="btn-mam" style="background:#111; color:var(--gold); border:1px solid var(--gold);">SAQUE BFA/BAI</button>
                    <button class="btn-mam">MULTICAIXA EXPRESS</button>
                </div>
            </div>
        </div>
    </main>
</div>

<footer>MAM DISTRIBUIDORA | PROPRIEDADE EXCLUSIVA DE MATIAS ARS√âNIO MANUEL</footer>

<script>
    const cfg = { apiKey: "AIzaSyBBsZS8EpszUtikaKS8B5te8C7Q9Ow-9wo", authDomain: "mam-distribuidora.firebaseapp.com", projectId: "mam-distribuidora", storageBucket: "mam-distribuidora.appspot.com", messagingSenderId: "670857002452", appId: "1:670857002452:web:404822b5376075e520ea41" };
    firebase.initializeApp(cfg);
    const auth = firebase.auth(), db = firebase.firestore();

    let isL = true;
    const CEO_EMAIL = "mamfilhos24@gmail.com";

    function toggleA() {
        isL = !isL;
        document.getElementById('aT').innerText = isL ? "HQ CENTRAL" : "REGISTO MAM";
        document.getElementById('cPass').classList.toggle('hidden', isL);
        document.getElementById('btnA').innerText = isL ? "ENTRAR NO SISTEMA" : "CRIAR CONTA AGORA";
    }

    async function authMAM() {
        const e = document.getElementById('email').value, p = document.getElementById('pass').value;
        try {
            if(isL) {
                await auth.signInWithEmailAndPassword(e, p);
                db.collection("lucro_mam").add({ valor: 3000, mot: "Login: "+e, data: new Date() });
            } else {
                const r = await auth.createUserWithEmailAndPassword(e, p);
                await db.collection("users").doc(r.user.uid).set({ email: e, saldo: 1000, uid: r.user.uid, nivel: "Normal" });
                db.collection("lucro_mam").add({ valor: 5000, mot: "Novo Artista: "+e, data: new Date() });
                alert("Conta de Artista Criada com Sucesso!");
            }
        } catch(err) { alert(err.message); }
    }

    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('authArea').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            // Controle Admin
            if(u.email === CEO_EMAIL) {
                document.getElementById('navAdmin').classList.remove('hidden');
                carregarStatsAdmin();
            } else {
                document.getElementById('navAdmin').classList.add('hidden');
            }

            db.collection("users").doc(u.uid).onSnapshot(d => {
                const s = d.data().saldo.toLocaleString() + ",00 Kz";
                document.getElementById('uSaldoBig').innerText = s;
            });
            carregarMusicas();
        } else {
            document.getElementById('authArea').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
        }
    });

    // SISTEMA DE TAREFA COM CONTADOR
    function iniciarContagem() {
        let tempo = 30;
        const btn = document.getElementById('btnTarefa');
        const display = document.getElementById('timerDisplay');
        btn.disabled = true;
        btn.innerText = "ASSISTINDO...";

        const clock = setInterval(async () => {
            tempo--;
            display.innerText = tempo + "s";
            if(tempo <= 0) {
                clearInterval(clock);
                display.innerText = "30s";
                btn.disabled = false;
                btn.innerText = "INICIAR TAREFA";
                
                // Paga ao utilizador e d√° lucro √† MAM
                const uid = auth.currentUser.uid;
                await db.collection("users").doc(uid).update({ saldo: firebase.firestore.FieldValue.increment(500) });
                db.collection("lucro_mam").add({ valor: 2000, mot: "Comiss√£o V√≠deo", data: new Date() }); // Lucro do Matias
                alert("Parab√©ns! 500 Kz creditados na tua carteira.");
            }
        }, 1000);
    }

    function carregarStatsAdmin() {
        db.collection("lucro_mam").onSnapshot(snap => {
            let total = 0; snap.forEach(d => total += d.data().valor);
            document.getElementById('admCofre').innerText = total.toLocaleString() + ",00 Kz";
        });
        db.collection("users").onSnapshot(snap => document.getElementById('admUsers').innerText = snap.size);
        db.collection("musicas").onSnapshot(snap => document.getElementById('admTracks').innerText = snap.size);
    }

    function carregarMusicas() {
        db.collection("musicas").onSnapshot(snap => {
            const fg = document.getElementById('fGlobal'); fg.innerHTML = "";
            snap.forEach(doc => {
                const m = doc.data();
                fg.innerHTML += `<div class="vinyl-case"><img src="${m.capa}" class="vinyl-disc"><p style="margin-top:10px; font-weight:bold;">${m.titulo}</p></div>`;
            });
        });
    }

    function tab(id, el) {
        document.querySelectorAll('.aba').forEach(a => a.classList.add('hidden'));
        document.getElementById('p' + id).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
        el.classList.add('active-nav');
    }

    function sair() { auth.signOut(); }
</script>
</body>
</html>
